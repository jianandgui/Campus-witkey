<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.edu.swpu.cins.weike.dao.MessageDao">


    <insert id="addMessage" parameterType="cn.edu.swpu.cins.weike.entity.persistence.Message">

      INSERT INTO
      message
      (fromId,toId,content,createDate,hasRead,conversationId)
      VALUES (#{fromId},#{toId},#{content},#{createDate},#{hasRead},#{conversationId})


    </insert>

    <select id="getConversationDetail" parameterType="String" resultType="cn.edu.swpu.cins.weike.entity.persistence.Message">

        SELECT * from
        message
        where conversationId=#{conversationId}
        ORDER BY createDate DESC
    </select>


    <select id="getConversationList" resultType="cn.edu.swpu.cins.weike.entity.persistence.Message" parameterType="int">
        SELECT * from
        (SELECT * from message WHERE fromId=#{userId} OR toId=#{userId} ORDER BY createDate DESC)
         GROUP BY conversationId ORDER BY createDate DESC

    </select>
</mapper>